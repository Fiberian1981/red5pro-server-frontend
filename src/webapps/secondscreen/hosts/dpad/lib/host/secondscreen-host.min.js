/*! red5pro-host-html-sdk - v0.5.2 - 2015-10-07
* Copyright (c) 2015 Infrared5; Licensed  */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(){this.buffer=[]}function e(a){this._input=a,this._index=-1,this._buffer=[]}function f(a){this._input=a,this._index=-1,this._buffer=[]}d.prototype.append=function(a){return this.buffer.push(a),this},d.prototype.toString=function(){return this.buffer.join("")};var g={codex:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){for(var b=new d,c=new e(a);c.moveNext();){var f=c.current;c.moveNext();var g=c.current;c.moveNext();var h=c.current,i=f>>2,j=(3&f)<<4|g>>4,k=(15&g)<<2|h>>6,l=63&h;isNaN(g)?k=l=64:isNaN(h)&&(l=64),b.append(this.codex.charAt(i)+this.codex.charAt(j)+this.codex.charAt(k)+this.codex.charAt(l))}return b.toString()},decode:function(a){for(var b=new d,c=new f(a);c.moveNext();){var e=c.current;if(128>e)b.append(String.fromCharCode(e));else if(e>191&&224>e){c.moveNext();var g=c.current;b.append(String.fromCharCode((31&e)<<6|63&g))}else{c.moveNext();var g=c.current;c.moveNext();var h=c.current;b.append(String.fromCharCode((15&e)<<12|(63&g)<<6|63&h))}}return b.toString()}};e.prototype={current:Number.NaN,moveNext:function(){if(this._buffer.length>0)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=Number.NaN,!1;var a=this._input.charCodeAt(++this._index);return 13==a&&10==this._input.charCodeAt(this._index+1)&&(a=10,this._index+=2),128>a?this.current=a:a>127&&2048>a?(this.current=a>>6|192,this._buffer.push(63&a|128)):(this.current=a>>12|224,this._buffer.push(a>>6&63|128),this._buffer.push(63&a|128)),!0}},f.prototype={current:64,moveNext:function(){if(this._buffer.length>0)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=64,!1;var a=g.codex.indexOf(this._input.charAt(++this._index)),b=g.codex.indexOf(this._input.charAt(++this._index)),c=g.codex.indexOf(this._input.charAt(++this._index)),d=g.codex.indexOf(this._input.charAt(++this._index)),e=a<<2|b>>4,f=(15&b)<<4|c>>2,h=(3&c)<<6|d;return this.current=e,64!=c&&this._buffer.push(f),64!=d&&this._buffer.push(h),!0}},b.exports=g},{}],2:[function(a,b,c){},{}],3:[function(a,b,c){function d(){}var e=b.exports={};e.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),e.title="browser",e.browser=!0,e.env={},e.argv=[],e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.binding=function(a){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(a){throw new Error("process.chdir is not supported")}},{}],4:[function(a,b,c){"use strict";var d="iphone",e="ipod",f="ipad",g=a("../environment/index"),h=g.getUserAgent().toLowerCase(),i=g.getAppName();b.exports={detectIphone:function(){return h.search(d)>-1},detectIpad:function(){return h.search(f)>-1},detectIpod:function(){return h.search(e)>-1},detectIOS:function(){return this.detectIphone()||this.detectIpod()||this.detectIpad()},detectAndroid:function(){return h.indexOf("android")>-1},detectInternetExplorerVersion:function(){var a=-1;if("Microsoft Internet Explorer"===i){var b=new RegExp(/msie ([0-9]{1,}[\.0-9]{0,})/);null!=b.exec(h)&&(a=parseFloat(RegExp.$1))}return a},onLoad:function(a){var b=Array.prototype.slice.call(arguments).slice(1),c=function(){a.apply(null,b)};g.loadComplete()?c():g.addLoadListener(c)}}},{"../environment/index":25}],5:[function(a,b,c){"use strict";var d=a("../../environment/index"),e=a("../../util/resource-util"),f=a("../../util/bind"),g=a("../../log/logger"),h=g.getLogger("Flash Util"),i=96,j=function(a,b){d.injectScript(a,b)},k=function(a){h.info("embedding..."),d.getSwfObject().embedSWF(a.url,a.id,"1","1",a.version,"",a.flashvars,a.params,a.attributes,function(b){b.success===!1?a.error("Could not properly embed Flash fallback."):b.success===!0&&a.success()})},l=function(a,b){var c={id:void 0,flashvars:void 0,url:b.options.swfUrl,version:"9.0.124",params:{quality:"high",bgcolor:"#ffffff",allowscriptaccess:"always",allowfullscreen:"true"},attributes:{id:b.flashObjID,name:"Red5 Pro SecondScreen Host",align:"middle",style:"float:left;z-index:-1;position:absolute;margin-top:-1px;"},error:f(b.options._error,b.options),success:f(b.options._success,b.options)},g=b.options.controlsUrl,l=d.createElement("div");l.id="red5pro-secondscreen-host-wrapper"+Math.floor(16777215*Math.random()*16777215).toString(16),d.appendElementToBody(l),l.style.zIndex=1e4,l.style.position="fixed",l.style.width="8px",l.style.height="8px",l.style.left="0px",l.style.bottom="0px",l.style.overflowX="hidden",l.style.overflowY="hidden";var m=d.createElement("div");m.id="red5pro-secondscreen-host-wrapper"+Math.floor(16777215*Math.random()*16777215).toString(16),d.appendElementToContainer(m,l);var n={globalName:d.globalName,bmDeviceName:encodeURIComponent(b.options.name),bmControllerXML:void 0,bmControllerUrl:void 0!==g?d.getAbsoluteUrl(g):void 0,wmode:"window",debug:"true"};h.info("Flash Object global name: "+n.globalName+"."),b&&b.options&&void 0!==b.options.appId&&void 0!==b.options.portalId?(n.bmDeviceId=b.options.appId,n.bmPortalId=b.options.portalId):n.bmDeviceId=Math.floor(16777215*Math.random()*16777215).toString(16),n.bmMaxPlayers=void 0!==b.options.maxPlayers?b.options.maxPlayers:i,b.deviceId=b.options.deviceId=n.bmDeviceId,e.generateControllerXML(b.options.design,function(a){n.bmControllerXML=encodeURIComponent(a),c.id=m.id,c.flashvars=n,"undefined"==typeof d.getSwfObject()?(h.info("Inject swfobject..."),j(b.options.swfobjectUrl,function(){k(c)})):(h.info("Embed SWF with swfobject."),k(c))})};b.exports={initializeFlashObject:l,getFlashObjectById:function(a){return d.getElement(a)}}},{"../../environment/index":25,"../../log/logger":27,"../../util/bind":33,"../../util/resource-util":38}],6:[function(a,b,c){"use strict";var d=a("../struct/base-classes"),e=a("../event/bridge"),f=a("../enum/encoding-type"),g=a("../util/debounce"),h=a("../util/bind"),i=a("../environment/index"),j=a("../log/logger"),k=a("../enum/error-type"),l=e.EventTypes,m=function(a,b){this.host=a,this.reliablePort=b,this.unreliablePort=b},n=function(a,b,c){this.methodName=a,this.returnMethod=b,this.data=c,this.ws=32},o=function(a,b){this.deviceId=a,this.deviceName=b,this.deviceType="WEBSOCKET",this.encodeType=f.FLASH},p="ws://54.82.36.3:6262/secondscreen",q={REGISTER:{method:"registry.register",handler:"onRegister"},UNREGISTER:{method:"registry.remove",handler:"onUnregister"},UPDATE:{method:"registry.update",handler:""},VISIBILITY:{method:"registry.setVisible",handler:""}},r=function(a,b){return new n(a.method,a.handler,b)},s=function(a){var b,c=a.length,d=[];for(b=0;c>b;b++)d[b]=a[b].value;return d},t=function(a,b){a._error.apply(a,[k.REGISTER_FAILURE,b])},u=d.EventEmitter.extend({init:function(a){this.domain={value:"secondscreen"},this.clientInfo={appId:a.options.appId,device:new o(a.options.deviceId,a.options.name),address:new m("192.168.2.1",6666),slotId:1,currentPlayers:0,maxPlayers:a.options.maxPlayers},this.hostConfig=a,this.websocket=null,this.registryUrl=a.options.registryUrl||p,this.update=g(this.update,500,this),this.logger=j.getLogger("WebSocket Registry"),this.logger.info("New Registry created for url "+this.registryUrl+"."),this.logger.info("Application id "+this.clientInfo.appId)},start:function(){try{this.logger.info("Request to start registry."),this.websocket=i.createWebSocket(this.registryUrl),this.websocket.onopen=h(this.onOpen,this),this.websocket.onmessage=h(this.onMessage,this),this.websocket.onerror=h(this.onError,this),this.websocket.onclose=h(this.onClose,this)}catch(a){throw new Error({type:k.REGISTER_FAILURE,message:a.message})}},stop:function(){var a=this.websocket;a.onopen=a.onclose=a.onmessage=a.onerror=null;try{var b=r(q.UNREGISTER,[this.clientInfo]);a.send(JSON.stringify(b)),a.close()}catch(c){}this.logger.info("Stopping registry.")},update:function(){var a=r(q.UPDATE,[this.clientInfo]);this.websocket.send(JSON.stringify(a))},setVisibility:function(a){var b=r(q.VISIBILITY,[{value:a},{value:!0}]);this.websocket.send(JSON.stringify(b))},setPlayerCount:function(a){this.logger.info("Setting current player count to "+a),this.clientInfo.currentPlayers=a,this.update()},onOpen:function(){this.logger.info("Registry socket opened.");var a=r(q.REGISTER,[this.clientInfo]);this.websocket.send(JSON.stringify(a))},onClose:function(){this.logger.info("Registry socket closed."),e.triggerWithType(l.REGISTRY_DISCONNECT,{})},onError:function(a){this.logger.error("Registry socket error: "+a.error),t(this.hostConfig.options,a.error),e.triggerWithType(l.REGISTRY_DISCONNECT,{error:a.error})},onRegister:function(a){a?this.logger.info("Registration accepted."):(this.logger.warn("Registration rejected. Url "+this.registryUrl+", appid: "+this.clientInfo.appId),t(this.hostConfig.options,"[WebSocketRegistryConnection]:: Failed to register"))},onUnregister:function(a){a?this.logger.info("Unregistration of host accepted."):(this.logger.warn("Unregistration rejected. Url "+this.registryUrl+", appid: "+this.clientInfo.appId),t(this.hostConfig.options,"[WebSocketRegistryConnection]:: Failed to unregister host."))},onMessage:function(a){var b=JSON.parse(a.data);switch(b.ws){case 32:var c=s(b.data),d=this[b.methodName];"function"==typeof d?(this.logger.info("Method invocation on Registry: "+b.methodName+"."),d.apply(this,c)):this.logger.warn("RegistryConnection function "+b.methodName+" not found: "+b.methodName+".");break;case 35:}},onHostConnected:function(a){a.device.deviceId===this.clientInfo.device.deviceId&&(this.clientInfo=a,e.triggerWithType(l.SHOW_SLOT_COLOR,{data:{slot:a.slotId}}))},onHostUpdate:function(a){a.device.deviceId===this.clientInfo.device.deviceId&&(this.clientInfo=a)},deviceConnectRequested:function(a){e.trigger(l.DEVICE_CONN_REQUEST,a)}});b.exports={WebSocketRegistry:u,createWebSocketRegistry:function(a,b){return new u(a,b)}}},{"../enum/encoding-type":21,"../enum/error-type":22,"../environment/index":25,"../event/bridge":26,"../log/logger":27,"../struct/base-classes":32,"../util/bind":33,"../util/debounce":34}],7:[function(a,b,c){"use strict";var d=a("../enum/encoding-type"),e=[],f=function(a){return{major:a>>24&255,minor:a>>16&255}},g=function(a){return{encodeType:a[0],type:a[1],id:a[2],name:a[3]}},h=function(a){return{device:g(a[1]),address:o(a[2])}},i=function(a){return{uid:a[1],address:o(a[2])}},j=function(){return{}},k=function(a){return{setId:a[1],startByte:a[2],chunkSize:a[3],totalSize:a[4],data:a[5]}},l=function(a){var b=0,c={};return c.device=g(a[++b]),c.address=o(a[++b]),c.appId=a[++b],c.slotId=a[++b],c.slotId>0&&(c.currentPlayers=a[++b],c.maxPlayers=a[++b]),c},m=function(a){var b=e[a[0]];if(b)return b(a);throw new Error("[websocket-serializer]:: No decoder for "+a)},n=function(a){var b={},c=0;return b.channel=a[++c],b.sequence=a[++c],b.timestamp=a[++c],b.rtt=a[++c],b.type=a[++c],b.deviceType=a[++c],b.deviceId=a[++c],b.deviceName=a[++c],a[++c]&&(b.message=m(a[++c])),b},o=function(a){return{hostname:a[1],udpPort:a[2],tcpPort:a[3]}},p=function(a){var b=a[1],c=a[2];return"@"===b&&(c=m(c)),[b,c]},q=function(a){var b,c,d=0,e=[],f={};for(++d,f.method=a[++d],f.returnMethod=a[++d],f.params=e,b=a[++d],c=d+b;c>d;)e.push(p(a[++d]));return f},r=function(a){return{x:a[1],y:a[2],z:a[3]}},s=function(a){var b,c=0,d=a[++c],e=[];for(b=0;d>b;++b){var f={};f.x=a[++c],f.y=a[++c],f.viewWidth=a[++c],f.viewHeight=a[++c],f.phase=a[++c],f.id=a[++c],e.push(f)}return{touches:e}},t=function(a){return{x:a[1],y:a[2],z:a[3]}},u=function(a){return{x:a[1],y:a[2],z:a[3],w:a[4]}},v=function(a){return{horizontal:a[1],vertical:a[2]}},w=function(a){return{id:a[2],value:a[1],isDown:a[3]}};!function(){e[d.PACKET]=n,e[d.ADDRESS]=o,e[d.PARAMETER]=p,e[d.INVOKE]=q,e[d.ACCELERATION]=r,e[d.TOUCH_SET]=s,e[d.ACK]=h,e[d.PING]=i,e[d.SHAKE]=j,e[d.BYTE_CHUNK]=k,e[d.REGISTRY_INFO]=l,e[d.GYRO]=t,e[d.ORIENTATION]=u,e[d.DPAD]=v,e[d.SLIDER]=w,e[d.DEVICE_IPHONE]=g,e[d.DEVICE_UNITY]=g,e[d.DEVICE_ANDROID]=g,e[d.DEVICE_NATIVE]=g,e[d.DEVICE_PALM]=g,e[d.DEVICE_FLASH]=g}(),b.exports={verifyHandshake:function(a,b,c){return f(a[0])==b&&f(a[1])==c},decodeObject:m,decodePacket:n}},{"../enum/encoding-type":21}],8:[function(a,b,c){"use strict";var d,e=a("../struct/base-classes"),f=a("../event/bridge"),g=a("../util/bind"),h=a("../util/resource-util"),i=a("../log/logger"),j=a("../enum/control-mode-type"),k=f.EventTypes,l={gyroscope:1,orientation:2},m=function(a,b,c){var d=h.cloneDesign(a);return d.commit=b,d.get=c,d},n=e.EventEmitter.extend({init:function(a,b,c){this._super(),this.id=b||(new Date).getTime().toString(),this.name=a||"Device-"+this.id,this.touchEnabled=!1,this.touchInterval=.1,this.accelerometerEnabled=!1,this.accelerometerInterval=.1,this.gyroEnabled=!1,this.gyroInterval=.1,this.orientationEnabled=!1,this.orientationInterval=.1,this.capabilities=0,this.mode=j.isValid(c)?c:j.GAMEPAD},setMode:function(a){a&&j.isValid(a)&&(this.mode=a)},getMode:function(){return this.mode},hasCapability:function(a){if(!(a in l))throw new Error("unknown capability: "+a);return 0!==(this.capabilities&l[a])}}),o=n.extend({init:function(a,b,c){this._super(a,b,c.options.controlMode),this.config=c,this.touchEnabled=c.options.design.touchEnabled,this.accelerometerEnabled=c.options.design.accelerometerEnabled,this.onConnectionMessage=g(this.onConnectionMessage,this),this.updateControlScheme=g(this.updateControlScheme,this),this.getControlSchemeElement=g(this.getControlSchemeElement,this),this.design=m(this.config.options.design,this.updateControlScheme,this.getControlSchemeElement),this.messageBuilder=void 0,f.on(k.CONNECTION_MESSAGE,this.onConnectionMessage),this.logger=i.getLogger("Generic Device Connection")},close:function(){f.off(k.CONNECTION_MESSAGE,this.onConnectionMessage)},sendInvoke:function(a){throw new Error("Requires override for message: "+a+".")},sendMessageToControls:function(){throw new Error("Requires override.")},updateControlScheme:function(){throw new Error("Requires override.")},getControlSchemeElement:function(a){throw new Error("Requires override for id: "+a+".")},onConnectionMessage:function(a){return a.data.device===this},waitForNewHost:function(a){this.sendInvoke(this.messageBuilder.createWaitForMessage(a)),this.mode=j.WAIT},vibrate:function(){this.sendInvoke(this.messageBuilder.createVibrateMessage())},editDesign:function(){return this.design},setMode:function(a,b){var c;this.mode!==a&&(c=j.index(a),j.isValid(a)?(this.logger&&this.logger.info("Setting new mode "+a+" on Device Connection "+this.id),this.sendInvoke(this.messageBuilder.createSetControlModeMessage(c,b)),this.mode=a):this.logger&&this.logger.error("Unknown control mode "+a))}});!function(a){var b,c=["gyro","touch","accelerometer","orientation"],e=c.length,f=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},g=function(a){var b=f(a);return{enabledField:a+"Enabled",enableMethod:"set"+b+"Enabled",intervalField:a+"Interval",intervalMethod:"set"+b+"Interval",accessEnabledMethod:"get"+b+"Enabled",accessIntervalMethod:"get"+b+"Interval"}},h=function(b){var c=g(b);a[c.enableMethod]=function(a){a!==this[c.enabledField]&&(this.sendInvoke(this.messageBuilder.createSensorEnableMessage(b,a,this[c.intervalField])),this[c.enabledField]=a)},a[c.intervalMethod]=function(a){a!==this[c.intervalField]&&(this.sendInvoke(this.messageBuilder.createSensorIntervalMessage(b,this[c.enabledField],a)),this[c.intervalField]=a)},a[c.accessEnabledMethod]=function(){return this[c.enabledField]},a[c.accessIntervalMethod]=function(){return this[c.intervalField]}},i=function(){for(var a,b=e,d=[];--b>-1;)a=f(c[b]),d.push("set"+a+"Enabled","get"+a+"Enabled","set"+a+"Interval","get"+a+"Interval");return d};for(b=e;--b>-1;)h(c[b]);d=i().concat(["close","setMode","sendMessageToControls"])}(o.prototype),b.exports={Device:n,DeviceConnection:o,DeviceConnectionProxyMethods:d}},{"../enum/control-mode-type":18,"../event/bridge":26,"../log/logger":27,"../struct/base-classes":32,"../util/bind":33,"../util/resource-util":38}],9:[function(a,b,c){"use strict";var d=a("./device-base"),e=a("./websocket-device"),f=a("./flash-bridge-device");b.exports={getProxyMethods:function(){return d.DeviceConnectionProxyMethods},createDeviceConnection:function(a,b,c){return e.createConnection(a,b,c)},createBridgeConnection:function(a,b,c,d,e){var g=f.createConnection(a,b,d,e);return g.setMode(c),g}}},{"./device-base":8,"./flash-bridge-device":10,"./websocket-device":14}],10:[function(a,b,c){"use strict";var d=a("./device-base").DeviceConnection,e=a("../event/bridge"),f=a("../util/resource-util"),g=a("./flash-message-builder"),h=a("../log/logger"),i=e.ConnectionEventTypes,j=d.extend({init:function(a,b,c,d){this._super(a,b,c),this.messageBuilder=g,this.invokeChannel=d,this.logger=h.getLogger("Fl Bridge Connection"),this.logger.info("New Bridge Connection created. Name: "+a+", DeviceId: "+b)},updateControlScheme:function(){var a=f.generateUpdateXML(this.design);this.sendInvoke(this.messageBuilder.createControlDesignUpdateMessage(a))},getControlSchemeElement:function(a){for(var b,c=this.design.layout,d=c?c.length:0;--d>-1;)if(b=c[d],b.id===a)return b;return void this.logger.warn("Could not find control scheme element with id "+a+".")},sendMessageToControls:function(a){var b=Array.prototype.splice.call(arguments,1);this.sendInvoke(this.messageBuilder.createMessageToJs(a,b))},sendInvoke:function(a){a.call(this,this.invokeChannel,this.id)},onConnectionMessage:function(a){var b=a.type,c=a.data;this._super(a)&&(this.logger.info("Device Message received: "+b+"."),c.device.id===this.id&&(b===i.CONTROL_SCHEME||b===i.SEND_PORTAL_ID||b===i.SET_CAPABILITIES&&(this.capabilities=c.capabilities?c.capabilities:0),this.trigger(b,a.data)))}});b.exports={createConnection:function(a,b,c,d){return new j(a,b,c,d)}}},{"../event/bridge":26,"../log/logger":27,"../util/resource-util":38,"./device-base":8,"./flash-message-builder":12}],11:[function(a,b,c){"use strict";var d=a("../struct/base-classes"),e=a("../environment/index"),f=a("../event/bridge"),g=a("../util/json-util"),h=(a("../util/bind"),a("../log/logger")),i=f.EventTypes,j=f.DeviceEventTypes,k=f.ConnectionEventTypes,l=["FlashLoaded","DeviceAvailable","DeviceConnected","DeviceDisconnected","DeviceEcho","NavigationString","TouchesReceived","KeyString","Invocation","ShakeReceived","AccelReceived","DPadReceived","SliderChange","Log","ShowSlot"],m=h.getLogger("Flash Responder"),n={setCapabilities:function(a,b){var c=b[0].Value,d=this.getDeviceById(a.id);m.info("Set capabilities ["+c+"] for device: "+d.id+"."),f.triggerConnectionMessage(k.SET_CAPABILITIES,{device:d,capabilities:c})},bmPause:function(a,b){m.info("Pause request for device: "+a.id+"."),f.triggerDeviceMessage(j.PAUSE,{device:a})},handleButtonAction:function(a,b,c){var d,e;return"undefined"==typeof c||1!==c.length?!1:(d=c[0].Value,"up"===d||"down"===d?(e="up"===d?j.BUTTON_UP:j.BUTTON_DOWN,f.triggerDeviceMessage(e,{device:a,id:b}),!0):!1)},onControlsUrlChange:function(a,b){f.triggerDeviceMessage(j.CONTROLS_URL_CHANGE,{device:a,url:b[0].Value})},messageFromJs:function(a,b){for(var c,d,e=b[0].Value,h=e.methodName,i=e.parameters,k=[],l=0;l<i.length;++l)c=i[l].Value,d=g.toJSON(c),k[l]="string"==typeof c&&d?d:c;f.triggerDeviceMessage(j.MESSAGE,{device:a,message:h,state:1===k.length?k[0]:k})}},o=d.Class.extend({init:function(a){this.target=a,this.devices={}},getDeviceById:function(a){return this.devices.hasOwnProperty(a)?this.devices[a]:void 0},FlashLoaded:function(){f.triggerConnectionMessage(k.FLASH_RUNTIME_LOADED,{})},ShowSlot:function(a){m.info("Show slot color. id: "+a+"."),f.triggerWithType(i.SHOW_SLOT_COLOR,{data:{slot:a}})},Invocation:function(a,b){var c=this.getDeviceById(b),d=a.parameters,e=a.methodName;m.info("Device Invocation. id: "+b+", invocation: "+JSON.stringify(a,null,2)),n.hasOwnProperty(e)?n[e].call(this,c,d):n.handleButtonAction(c,e,d)||m.warn("Could not handle method invocation. methodName: "+e+".")},DeviceAvailable:function(a){m.info("Device Available. device: "+JSON.stringify(a,null,2)),f.trigger(i.DEVICE_CONN_REQUEST,a)},DeviceConnected:function(a){var b=a.deviceId,c=a.deviceName,d=this.getDeviceById(b);m.info("Device Connected. id: "+b+", name: "+c+"."),d&&(f.triggerConnectionMessage(k.ADD_DEVICE,{device:d}),f.triggerDeviceMessage(j.MESSAGE,{device:d,message:"ready"}))},DeviceDisconnected:function(a){var b=a.deviceId,c=a.deviceName;m.info("Device Disonnected. id: "+b+", name: "+c+"."),f.triggerConnectionMessage(k.REMOVE_DEVICE,{device:this.getDeviceById(b)})},DeviceEcho:function(a,b){m.info("Echo: "+a+".\nDevice:\n"+JSON.stringify(b,null,2))},NavigationString:function(a,b){m.info("Navigation Event. "+b+"."),f.triggerDeviceMessage(j.NAVIGATION,{device:this.getDeviceById(a),string:b})},KeyString:function(a,b){m.info("KeyString Event."+b+"."),f.triggerDeviceMessage(j.KEYBOARD,{device:this.getDeviceById(a),text:b})},TouchesReceived:function(a){var b,c,d,e=a.deviceId,g=a.touches,h=g.length;for(b=0;h>b;b++){switch(c=g[b],c.phase.value){case 1:d=j.TOUCH_START;break;case 2:d=j.TOUCH_MOVE;break;case 4:d=j.TOUCH_END;break;default:m.warn("Could not handle touch type of phase: "+c.phase+".\n"+JSON.stringify(a,null,2))}f.triggerDeviceMessage(d,{device:this.getDeviceById(e),x:c.x,y:c.y,id:e+c.id})}},AccelReceived:function(a){var b=a.deviceId,c=a.acceleration;f.triggerDeviceMessage(j.ACCELERATION,{device:this.getDeviceById(b),acceleration:c})},ShakeReceived:function(a){var b=a.deviceId;f.triggerDeviceMessage(j.SHAKE,{device:this.getDeviceById(b)})},SliderChange:function(a){var b=a.deviceId;f.triggerDeviceMessage(j.SLIDER,{device:this.getDeviceById(b),id:a.sliderId,value:a.value})},DPadReceived:function(a){var b=a.deviceId;f.triggerDeviceMessage(j.DPAD,{device:this.getDeviceById(b),horizontal:a.horizontal,vertical:a.vertical})}}),p=o.extend({init:function(a){this._super(a),e.defineGlobalTarget(this)},register:function(a){m.info("Register connection to bridge responder: "+a.id),this.devices[a.id]=a},unregister:function(a){m.info("Unregister connection to bridge responder: "+a.id),this.devices.hasOwnProperty(a.id)&&delete this.devices[a.id]},unregisterAll:function(){var a;for(a in this.devices)delete this.devices[a]},connectionSuccess:function(a){var b;this.devices.hasOwnProperty(a)?(b=this.devices[a],f.triggerConnectionMessage(k.ADD_DEVICE,{device:b})):m.info("Could not find device registered with id: "+a+".")},boomBa:function(a){m.info("Flash fallback embedded successfully. "+a+".")},log:function(a){m.info("Flash action taken: "+a+".")},helper:{logger:function(){return h.getLogger("Flash Resp.Helper")}(),helperTick:function(){},__noSuchMethod__:function(a,b){this.logger.warn("No such method: "+a+", "+JSON.stringify(b,null,2))}}});!function(a){for(var b,c=l.length,d=function(a){return["on",a,"Internal"].join("")};--c>-1;)b=l[c],a[d(b)]=a[b];a.showSlotInternal=a.ShowSlot,a.__noSuchMethod__=function(a,b){m.warn("No Such Method: "+a+", "+JSON.stringify(b,null,2))}}(p.prototype),b.exports={create:function(a){return new p(a)}}},{"../environment/index":25,"../event/bridge":26,"../log/logger":27,"../struct/base-classes":32,"../util/bind":33,"../util/json-util":36}],12:[function(a,b,c){"use strict";var d=a("../log/logger"),e=a("../enum/control-mode-type"),f=d.getLogger("Flash Message Builder"),g=function(a){var b=e.value(a),c="SetGamepadMode";switch(b){case e.NAVIGATION:c="SetNavMode";break;case e.KEYBOARD:c="SetKeyboardMode";break;case e.WAIT:c="SetWaitMode"}return f.info("Request Control Mode: "+b+"."),c};b.exports={createSetControlModeMessage:function(a,b){var c=g(a);return function(a,d){return"string"==typeof b?a[c](d,b):a[c](d)}},createWaitForMessage:function(){return function(a,b){return a.SetWaitForNewHost(b)}},createSensorEnableMessage:function(a,b,c){return a=a.charAt(0).toUpperCase()+a.slice(1),function(d,e){return f.info("Enable sensor: "+a+", enabled: "+b+", interval: "+c),d["Enable"+a](e,b,c)}},createSensorIntervalMessage:function(a,b,c){return this.createSensorEnableMessage(a,b,c)},createControlDesignUpdateMessage:function(a,b){return function(c,d){return c.updateControlPad(d,a,b||function(){})}},createVibrateMessage:function(){return function(a,b){return a.VibrateDevice(b)}},createMessageToJs:function(a,b){return function(c,d){return c.MessageToJs(d,a,b)}}}},{"../enum/control-mode-type":18,"../log/logger":27}],13:[function(a,b,c){"use strict";var d=a("../struct/base-classes"),e=a("../event/bridge"),f=a("../util/json-util"),g=a("../log/logger"),h=a("../enum/channel-type"),i=(e.EventTypes,e.DeviceEventTypes),j=e.ConnectionEventTypes,k=g.getLogger("WebSocket Channel Responder"),l={RequestXML:function(a,b){e.triggerConnectionMessage(j.CONTROL_SCHEME,{device:a})},GetPortalId:function(a,b){e.triggerConnectionMessage(j.SEND_PORTAL_ID,{device:a,returnMethod:b.returnMethod})},setCapabilities:function(a,b){e.triggerConnectionMessage(j.SET_CAPABILITIES,{device:a,capabilities:b.params[0][1]}),e.triggerConnectionMessage(j.ADD_DEVICE,{device:a})},onControlSchemeParsed:function(a){e.triggerDeviceMessage(i.MESSAGE,{device:a,message:"ready"})},WaitCancelled:function(a,b){e.triggerDeviceMessage(i.WAIT_CANCELLED,{device:a})},bmPause:function(a,b){e.triggerDeviceMessage(i.PAUSE,{device:a})},onKeyString:function(a,b){e.triggerDeviceMessage(i.KEYBOARD,{device:a,text:b.params[0][1]})},onNavigationString:function(a,b){e.triggerDeviceMessage(i.NAVIGATION,{device:a,string:b.params[0][1]})},onControlsUrlChange:function(a,b){e.triggerDeviceMessage(i.CONTROLS_URL_CHANGE,{device:a,url:b.params[0][1]})},messageFromJs:function(a,b){for(var c,d,g,h=b.params[0][1],j=h.method,k=h.params,l=0;l<k.length;++l)d=k[l][0],g=k[l][1],c=f.toJSON(g),k[l]="*"===d&&c?c:g;e.triggerDeviceMessage(i.MESSAGE,{device:a,message:j,state:1===k.length?k[0]:k})}},m=function(a,b){var c,d;1===b.params.length&&(c=b.params[0][1],("up"===c||"down"===c)&&(d="up"===c?i.BUTTON_UP:i.BUTTON_DOWN,e.triggerDeviceMessage(d,{device:a,id:b.method})))},n=d.Class.extend({init:function(a){this.target=a},handlePacket:function(a){var b=a.channel,c=a.deviceName,d=a.message,f=d?d.method:void 0;if(void 0!==f&&b===h.MESSAGE)this.target.name=c,k.info("Message received: "+f+"."),l.hasOwnProperty(f)?l[f].call(null,this.target,d):m(this.target,d);else if(h.SHAKE===b)e.triggerDeviceMessage(i.SHAKE,{device:this.target});else if(h.ACCELERATION===b)e.triggerDeviceMessage(i.ACCELERATION,{device:this.target,acceleration:d});else if(h.TOUCH===b){var g,j,n=d.touches,o=n.length;for(g=0;o>g;g++){switch(n[g].phase){case 1:j=i.TOUCH_START;break;case 2:j=i.TOUCH_MOVE;break;case 4:j=i.TOUCH_END}e.triggerDeviceMessage(j,{device:this.target,x:n[g].x,y:n[g].y,id:this.target.id+n[g].id})}}else h.GYRO===b?e.triggerDeviceMessage(i.GYROSCOPE,{device:this.target,gyroscope:d}):h.ORIENTATION===b?e.triggerDeviceMessage(i.ORIENTATION,{device:this.target,orientation:d}):h.DPAD===b?e.triggerDeviceMessage(i.DPAD,{device:this.target,horizontal:d.horizontal,vertical:d.vertical}):h.SLIDER===b&&e.triggerDeviceMessage(i.SLIDER,{device:this.target,id:d.id,value:d.value})}});b.exports={create:function(a){return new n(a)}}},{"../enum/channel-type":17,"../event/bridge":26,"../log/logger":27,"../struct/base-classes":32,"../util/json-util":36}],14:[function(a,b,c){"use strict";var d=a("./device-base").DeviceConnection,e=a("../event/bridge"),f=a("../encoding/websocket-serializer"),g=a("../decoding/websocket-deserializer"),h=a("./websocket-channel-responder"),i=a("./websocket-message-builder"),j=a("../util/bind"),k=a("../util/resource-util"),l=a("../log/logger"),m=a("../enum/control-mode-type"),n=a("../enum/encoding-type"),o=a("../enum/packet-type"),p=a("../enum/channel-type"),q=e.EventTypes,r=e.ConnectionEventTypes,s=a("../environment/index"),t={major:1,minor:4},u={channel:p.BYTE,message:void 0},v=function(a,b){return b&&(a.major<b.major||a.major===b.major&&a.minor<b.minor)?b:a},w=function(a){return u.message=a,u},x=function(a){return"undefined"!=typeof a},y=d.extend({init:function(a,b,c){this._super(a,b,c),this.sequence=0,this.controlsSent=!1,this.version=t,this.minimumVersion=v(this.version,c.options.minimumVersion),this.messageBuilder=i,this.channelResponder=h.create(this),this.hostDevice=void 0,this.hostAddress=void 0,this.controlScemeChunks=void 0,this.logger=l.getLogger("Connection"),this.logger.info("New Device Connection created. Name: "+a+", DeviceId: "+b)},connect:function(a,b,c){this.url=a,this.hostDevice=b,this.hostAddress=c,this.logger.info("Request to connect on "+a+"."),this.logger.info("HostDevice for Connection "+this.id+": "+this.hostDevice.id),this.socket=s.createWebSocket(this.url),this.socket.onopen=j(this.onOpen,this),this.socket.onmessage=j(this.onInitialMessage,this),this.socket.onerror=j(this.onError,this),this.socket.onclose=j(this.onClose,this)},close:function(){var a=this.socket;"undefined"!=typeof a&&a.close(),this.logger.info("Closing Device Connection "+this.id),e.off(q.CONNECTION_MESSAGE,this.onConnectionMessage)},generatePacket:function(a){return a.sequence=++this.sequence,a.deviceId=this.hostDevice.id,a.deviceType=this.hostDevice.type,a.channel=a.channel||p.BROADCAST,a.type=a.type||o.DATA,a.rtt=0,a.timestamp=0,f.encodePacket(a)},sendInvoke:function(a){var b=this.generatePacket(a);this.logger.info("sendInvoke: "+JSON.stringify(b)),this.socket.send(JSON.stringify(b))},sendChunks:function(a){var b,c=a.length;for(b=0;c>b;++b)this.socket.send(JSON.stringify(this.generatePacket(w(a[b]))))},sendMessageToControls:function(a){var b=Array.prototype.splice.call(arguments,1);this.sendInvoke(this.messageBuilder.createMessageToJs(a,b))},sendControlScheme:function(){var a=this.config.options.controlsUrl;this.mode===m.HTML&&void 0!==a?this.sendInvoke(this.messageBuilder.createControlsUrlMessage(s.getAbsoluteUrl(a))):void 0!==this.controlSchemeChunks?this.sendChunks(this.controlSchemeChunks):!function(a,b){var c;k.generateControllerXML(b,function(b){c=f.generateControlChunks(b),a.controlSchemeChunks=c,a.sendChunks(c)})}(this,this.design)},updateControlScheme:function(){var a=k.generateUpdateXML(this.design);this.sendChunks(f.generateUpdateChunks(a))},getControlSchemeElement:function(a){for(var b,c=this.design.layout,d=c?c.length:0;--d>-1;)if(b=c[d],b.id===a)return b;return void this.logger.warn("Could not find control scheme element with id "+a+".")},onOpen:function(){var a=f.createHandshake(this.version,this.minimumVersion);this.logger.info("Socket Opened. "+this.id),this.socket.send(JSON.stringify(a))},onClose:function(){this.logger.info("Socket Closed. "+this.id),e.trigger(q.CONNECTION_MESSAGE,{type:r.REMOVE_DEVICE,data:{device:this}})},onError:function(a){var b="Could not connect to device websocket layer. Error: "+a.error+", Info: ["+this.id+", "+this.name+"]";this.logger.error("Socket Error. "+b),this.onClose(),e.trigger(q.CONNECTION_MESSAGE,{type:r.DEVICE_ERROR,data:{device:this,error:b}})},onInitialMessage:function(){var a;this.logger.info("Initial handshake received for Device Connection "+this.id),this.socket.onmessage=j(this.onMessage,this),a=this.generatePacket({type:o.ACK,message:{encodeType:n.ACK,device:this.hostDevice,address:this.hostAddress}}),this.socket.send(JSON.stringify(a)),this.sendInvoke(this.messageBuilder.createTouchReliabilityMessage())},onMessage:function(a){var b=JSON.parse(a.data),c=g.decodePacket(b);

this.channelResponder.handlePacket(c)},onConnectionMessage:function(a){var b=a.type,c=a.data;if(this._super(a)){if(this.logger.info("Device Message received: "+b),b===r.CONTROL_SCHEME)this.sendControlScheme();else if(b===r.SEND_PORTAL_ID){var d=this.config.options.portalId,e=x(d);this.logger.warn("Is portal id "+d+" valid? "+x(d)),e&&this.sendInvoke(this.messageBuilder.createSendPortalIdMessage(c.returnMethod,d))}else b===r.SET_CAPABILITIES&&(this.capabilities=c.capabilities?c.capabilities:0);this.trigger(b,a.data)}}});b.exports={createConnection:function(a,b,c){return new y(a,b,c)}}},{"../decoding/websocket-deserializer":7,"../encoding/websocket-serializer":16,"../enum/channel-type":17,"../enum/control-mode-type":18,"../enum/encoding-type":21,"../enum/packet-type":23,"../environment/index":25,"../event/bridge":26,"../log/logger":27,"../util/bind":33,"../util/resource-util":38,"./device-base":8,"./websocket-channel-responder":13,"./websocket-message-builder":15}],15:[function(a,b,c){"use strict";var d=a("../enum/channel-type"),e=a("../enum/encoding-type"),f=function(a,b,c){return{channel:d.MESSAGE,message:{method:a,returnMethod:b,params:c,encodeType:e.INVOKE}}},g=function(a){if("number"==typeof a)return a===(0|a)?["i",a]:["f",a];if("string"==typeof a||a instanceof String)return["*",a];if("object"==typeof a)return["*",JSON.stringify(a)];if(null===a)return["*",""];throw new Error("unable to encode value: "+a)},h=function(a){for(var b=[],c=0;c<a.length;++c)b[c]=g(a[c]);return{array:b,encodeType:e.TAGGED_ARRAY}};b.exports={createInvokeMessage:f,createSendPortalIdMessage:function(a,b){return f(a,"",[["*",b]])},createTouchReliabilityMessage:function(){return f("setReliabilityForTouch","",[["i",2],["i",2]])},createSetControlModeMessage:function(a,b){var c="SetControlMode",d="";return void 0!==b?f(c,d,[["i",a],["*",b]]):f(c,d,[["i",a]])},createWaitForMessage:function(a){return f("WaitForNewHost",[["*",a]])},createSensorEnableMessage:function(a,b,c){return a=a.charAt(0).toUpperCase()+a.slice(1),f("enable"+a,"",[["B",b]])},createSensorIntervalMessage:function(a,b,c){return a=a.charAt(0).toUpperCase()+a.slice(1),f("set"+a+"Interval","",[["f",c]])},createVibrateMessage:function(){return f("vibrate","",[])},createControlsUrlMessage:function(a){return f("loadControlsUrl","",[["*",a]])},createMessageToJs:function(a,b){return f("messageToJs","",[["*",a],["@",h(b)]])}}},{"../enum/channel-type":17,"../enum/encoding-type":21}],16:[function(a,b,c){"use strict";var d=a("../enum/encoding-type"),e=a("../environment/index"),f=[],g=function(a){return e.base64Encode(a)},h=function(a){return(255&a.major)<<24|(255&a.minor)<<16},i=function(a,b){var c,e,f,h,i=32768,j=[],k=a.length,l=0,m=0;for(l=0;k>l;l+=i)c=g(a.substr(l,i)),e=c[0],f=c[1],j.push({encodeType:d.BYTE_CHUNK,setId:b,startByte:m,chunkSize:e,data:f}),m+=e;for(h=j.length;--h>-1;)j[h].totalSize=m;return j},j=function(a){return[a.encodeType,a.type,a.id,a.name]},k=function(a){return[d.ACK,j(a.device),s(a.address)]},l=function(a){return[d.PING,a.uid,s(a.address)]},m=function(){return[d.SHAKE,0]},n=function(a){return[d.BYTE_CHUNK,a.setId,a.startByte,a.chunkSize,a.totalSize,a.data]},o=function(a){var b,c,e=a.array,f=[d.TAGGED_ARRAY,e.length],g=e.length;for(b=0;g>b;++b)c=e[b],f.push(c[0]),f.push("@"===c[0]?q(c[1]):c[1]);return f},p=function(a){var b=[d.REGISTRY_INFO,j(a.device),s(a.address),a.appId,a.slotId];return a.slotId>0&&(b.push(a.currentPlayers),b.push(a.maxPlayers)),b},q=function(a){var b=f[a.encodeType];if(b)return b(a);throw new Error("[websocket-serializer]:: No encoder for "+JSON.stringify(a,null,3))},r=function(a){return[d.PACKET,a.channel,a.sequence,0,0,a.type,a.deviceType,a.deviceId,a.deviceName,!0,q(a.message)]},s=function(a){return[d.ADDRESS,a.hostname,a.udpPort,a.tcpPort]},t=function(a){return[d.PARAMETER,a[0],"@"===a[0]?q(a[1]):a[1]]},u=function(a){var b,c=a.params,e=[d.INVOKE,0,a.method,a.returnMethod,c.length],f=c.length;for(b=0;f>b;++b)e.push(t(c[b]));return e},v=function(a){return[d.ACCELERATION,a.x,a.y,a.z]},w=function(a){var b,c,e=a.touches,f=[d.TOUCH_SET,e.length],g=e.length;for(b=0;g>b;++b)c=e[b],f.push(c.x,c.y,c.viewWidth,c.viewHeight,c.phase,c.id);return f},x=function(a){return[d.GYRO,a.x,a.y,a.z]},y=function(a){return[d.ORIENTATION,a.x,a.y,a.z,a.w]},z=function(a){return[d.DPAD,a.horizontal,a.vertical]},A=function(a){return[d.SLIDER,a.value,a.id,a.isDown?!0:!1]};!function(){f[d.PACKET]=r,f[d.ADDRESS]=s,f[d.PARAMETER]=t,f[d.INVOKE]=u,f[d.ACCELERATION]=v,f[d.TOUCH_SET]=w,f[d.ACK]=k,f[d.PING]=l,f[d.SHAKE]=m,f[d.BYTE_CHUNK]=n,f[d.TAGGED_ARRAY]=o,f[d.REGISTRY_INFO]=p,f[d.GYRO]=x,f[d.ORIENTATION]=y,f[d.DPAD]=z,f[d.SLIDER]=A,f[d.DEVICE_IPHONE]=j,f[d.DEVICE_UNITY]=j,f[d.DEVICE_ANDROID]=j,f[d.DEVICE_NATIVE]=j,f[d.DEVICE_PALM]=j,f[d.DEVICE_FLASH]=j}(),b.exports={createHandshake:function(a,b){return[h(a),h(b)]},generateControlChunks:function(a){return i(a,"testXML")},generateUpdateChunks:function(a){return i(a,"updateXML")},encodeObject:q,encodePacket:r}},{"../enum/encoding-type":21,"../environment/index":25}],17:[function(a,b,c){"use strict";b.exports={BROADCAST:0,ACCELERATION:1,TOUCH:2,MESSAGE:3,SHAKE:4,BYTE:5,GYRO:6,ORIENTATION:7,DPAD:8,SLIDER:9}},{}],18:[function(a,b,c){"use strict";var d="gamepad",e="keyboard",f="navigation",g="wait",h="html",i=[d,e,f,g,h];b.exports={GAMEPAD:d,KEYBOARD:e,NAVIGATION:f,WAIT:g,HTML:h,index:function(a){return i.indexOf(a)},value:function(a){return a=0>a?0:a,a=a>i.length-1?i.length-1:a,i[a]},isValid:function(a){return this.index(a)>-1}}},{}],19:[function(a,b,c){"use strict";b.exports={ANY:0,UNITY:1,IPHONE:2,FLASH:3,ANDROID:4,NATIVE:5}},{}],20:[function(a,b,c){"use strict";b.exports={DEAD:0,UP:-1,DOWN:1,LEFT:-1,RIGHT:1}},{}],21:[function(a,b,c){"use strict";b.exports={PACKET:0,ADDRESS:1,PARAMETER:3,INVOKE:4,ACCELERATION:5,TOUCH_SET:6,DEVICE_IPHONE:7,DEVICE_UNITY:8,DEVICE_ANDROID:10,DEVICE_NATIVE:15,DEVICE_PALM:16,DEVICE_SERVER:17,DEVICE_FLASH:18,ACK:9,PING:11,SHAKE:13,BYTE_CHUNK:14,REGISTRY_INFO:19,TAGGED_ARRAY:21,GYRO:22,ORIENTATION:23,DPAD:24,SLIDER:25}},{}],22:[function(a,b,c){"use strict";b.exports={ERROR:0,APPLICATION_ID_REQUIRED:1,RUNTIME_FAILURE:2,REGISTER_FAILURE:3}},{}],23:[function(a,b,c){"use strict";b.exports={DATA:0,PING:1,ACK:2,ECHO:3,ANALYSIS:4,KEEP_ALIVE:5}},{}],24:[function(a,b,c){"use strict";var d=a("../../lib/base64"),e=!1;if("btoa"in window){var f=d.encode;d.encode=function(a){try{return[a.length,window.btoa(a)]}catch(b){return f(a)}}}b.exports={globalName:"red5prosecondscreenhost"+Math.floor(16777215*Math.random()*16777215).toString(16),exposeNoConflict:function(a){var b,c=function(){return"undefined"!=typeof b&&(window.secondscreenHost=b),a};"secondscreenHost"in window?b=window.secondscreenHost:(a.noConflict=c,window.secondscreenHost=a)},defineGlobalTarget:function(a){window[this.globalName]=a},getGlobalTarget:function(){return window[this.globalName]},getLocationSearch:function(){return document.location.search},getUserAgent:function(){return navigator.userAgent},getAppName:function(){return navigator.appName},loadComplete:function(){return"complete"===document.readyState||"interactive"===document.readyState},addLoadListener:function(a){window.addEventListener?window.addEventListener("DOMContentLoaded",a,!1):window.attachEvent("onload",a)},addUnloadListener:function(a){window.addEventListener?window.addEventListener("beforeunload",a,!1):window.attachEvent("onbeforeunload",a)},injectScript:function(a,b){var c=document.createElement("script");c.type="text/javascript",c.onload=b,c.onreadystatechange=function(){("loaded"===c.readyState||"complete"===c.readyState)&&(c.onreadystatechange=null,b())},c.src=a,document.getElementsByTagName("head")[0].appendChild(c)},getSwfObject:function(){return window.swfobject},createElement:function(a){return document.createElement(a)},getElement:function(a){return document.getElementById(a)},appendElementToBody:function(a){document.body.appendChild(a)},appendElementToContainer:function(a,b){b.appendChild(a)},loadImage:function(a,b,c){var d=new Image,e=this;d.onload=function(){var b,f=e.createElement("canvas"),g=f.getContext("2d");f.width=d.width,f.height=d.height,g.drawImage(d,0,0),b=f.toDataURL().replace("data:image/png;base64,",""),c({data:b,width:d.width,height:d.height,url:a})},d.onerror=b,d.src=a},supportsWebSockets:function(){return!e&&"WebSocket"in window},supportsBTOAEncoding:function(){return"btoa"in window},base64Encode:function(a){return d.encode(a)},createWebSocket:function(a){return new WebSocket(a)},getAbsoluteUrl:function(a){var b=document.createElement("img");return b.src=a,a=b.src,b.src=null,a},forceFlash:function(){e=!0}}},{"../../lib/base64":1}],25:[function(a,b,c){(function(c){var d=c.browser;d?b.exports=a("./browser"):b.exports=a("./node")}).call(this,a("JkpR2F"))},{"./browser":24,"./node":2,JkpR2F:3}],26:[function(a,b,c){"use strict";var d=a("../struct/base-classes"),e={DEVICE_CONN_REQUEST:"connectrequest",REGISTRY_DISCONNECT:"registrydisconnect",SHOW_SLOT_COLOR:"showslotcolor",CONNECTION_MESSAGE:"connectionmessage",DEVICE_MESSAGE:"devicemessage"},f={ADD_DEVICE:"adddevice",REMOVE_DEVICE:"removedevice",DEVICE_ERROR:"deviceerror",CONTROL_SCHEME:"controlscheme",SEND_PORTAL_ID:"sendportalid",SET_CAPABILITIES:"setcapabilities",DEVICE_CONNECTED:"deviceconnected",DEVICE_DISCONNECTED:"devicedisconnected",DEVICE_CONN_ERROR:"deviceconnecterror",FLASH_RUNTIME_LOADED:"flashruntimeloaded"},g={PAUSE:"pause",WAIT_CANCELLED:"waitcancelled",NAVIGATION:"navstring",KEYBOARD:"keyboard",BUTTON_UP:"buttonup",BUTTON_DOWN:"buttondown",SHAKE:"shake",ACCELERATION:"acceleration",TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",GYROSCOPE:"gyroscope",ORIENTATION:"orientation",DPAD:"dpad",SLIDER:"slider",MESSAGE:"message",CONTROLS_URL_CHANGE:"controlsurlchange"},h=d.EventEmitter.extend({init:function(){this._super(),this.EventTypes=e,this.DeviceEventTypes=g,this.ConnectionEventTypes=f},triggerDeviceMessage:function(a,b){this.trigger(this.EventTypes.DEVICE_MESSAGE,{type:a,data:b})},triggerConnectionMessage:function(a,b){this.trigger(this.EventTypes.CONNECTION_MESSAGE,{type:a,data:b})}});b.exports=new h},{"../struct/base-classes":32}],27:[function(a,b,c){"use strict";var d="log",e="info",f="debug",g="warn",h="error",i="none",j=0,k=[d,e,f,g,h],l=function(a){var b,c=16;if(a.length>c)b=a.substr(0,c-1);else for(b=a;b.length<c-1;)b+=" ";return b},m=function(a){this.name=l(a)};m.prototype.format=function(a,b){var c=new Date,d=c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()+":"+c.getMilliseconds();return"-"+this.name+"- "+d+" ["+a.toUpperCase()+"] :: "+b},m.prototype.print=function(a,b){var c=k.indexOf(a);0===c?console.log(this.format(a,b)):c>=j&&console[a](this.format(a,b))},function(a,b){for(var c=a.length;--c>-1;)!function(a){b[a]=function(b){this.print.call(this,a,b)}}(a[c])}(k,m.prototype),b.exports={LogLevels:{LOG:d,INFO:e,DEBUG:f,WARN:g,ERROR:h,NONE:i},setLogLevel:function(a){var b=k.indexOf(a);b>-1?j=b:a===i&&(j=k.length)},getLogger:function(a){return new m(a)}}},{}],28:[function(a,b,c){var d=a("../struct/base-classes"),e=a("../event/bridge"),f=a("../device/device-factory"),g=a("../device/flash-channel-responder"),h=a("../browser/detection"),i=a("../browser/plugin/flash-util"),j=a("../util/bind"),k=a("../util/resource-util"),l=a("../log/logger"),m=a("../enum/control-mode-type"),n=e.EventTypes,o=e.ConnectionEventTypes,p=l.getLogger("Flash Runtime"),q=function(a){var b=a.options.design;if("string"==typeof b)i.initializeFlashObject([],a);else if(-1!==h.detectInternetExplorerVersion())p.warn("IE version detected that does not allow Image preloading."),i.initializeFlashObject([],a);else if("object"==typeof b){var c=b.images?b.images:[];c&&0===c.length?i.initializeFlashObject(c,a):(p.info("Loading resource image before initalizing object embed..."),k.loadImages(c,function(b){i.initializeFlashObject(b,a)}))}},r=d.Class.extend({init:function(){this.flashObjID=Math.floor(16777215*Math.random()*16777215).toString(16),this.handleConnectionMessage=j(this.handleConnectionMessage,this),this.handleDeviceConnectRequest=j(this.handleDeviceConnectRequest,this),this.responder=g.create(),this.pendingConnections=[],this.pending=!1},start:function(a){var b;return a.flashObjID=this.flashObjID,this.config=a,this.pending=!0,b=this.config._success,function(a){a.config._success=function(){a.pending=!1,b.apply(a.config,arguments)}}(this),p.info("Starting Flash Runtime instance as Host Runtime."),p.info("FlashObjectId: "+a.flashObjID),p.info("SWF file to load: "+a.options.swfUrl),e.on(n.CONNECTION_MESSAGE,this.handleConnectionMessage),e.on(n.DEVICE_CONN_REQUEST,this.handleDeviceConnectRequest),h.onLoad(q,this.config),this},stop:function(){return p.info("Stopping Flash Runtime instance as Host Runtime."),this.getFlashObject().stop(),this.config=void 0,this.responder.unregisterAll(),e.off(n.CONNECTION_MESSAGE,this.handleConnectionMessage),e.off(n.DEVICE_CONN_REQUEST,this.handleDeviceConnectRequest),this},getPendingConnectionIndex:function(a){for(var b=this.pendingConnections.length;--b>-1;)if(this.pendingConnections[b].id===a.id)return b;return-1},addPendingConnection:function(a){var b=this.getPendingConnectionIndex(a);-1===b&&(this.pendingConnections.push(a),this.responder.register(a))},removePendingConnection:function(a){var b=this.getPendingConnectionIndex(a);b>-1&&this.pendingConnections.splice(b,1)},addConnection:function(a){this.removePendingConnection(a)},removeConnection:function(a){this.responder.unregister(a)},setVisibility:function(a){var b=this.getFlashObject();if(void 0!==b)try{b.SetVisibility(a,!0)}catch(c){}},getFlashObject:function(){return i.getFlashObjectById(this.flashObjID)},handleConnectionMessage:function(a){a.type===o.FLASH_RUNTIME_LOADED?(p.info("Flash Runtime Embedded and Loaded."),this.responder.target=this.getFlashObject()):a.type===o.ADD_DEVICE?this.addConnection(a.data.device):a.type===o.REMOVE_DEVICE&&this.removeConnection(a.data.device)},handleDeviceConnectRequest:function(a){var b,c=a.deviceId,d=a.deviceName,e=m.value(a.controlMode);b=f.createBridgeConnection(d,c,e,this.config,this.getFlashObject()),this.addPendingConnection(b)}});b.exports={Runtime:r}},{"../browser/detection":4,"../browser/plugin/flash-util":5,"../device/device-factory":9,"../device/flash-channel-responder":11,"../enum/control-mode-type":18,"../event/bridge":26,"../log/logger":27,"../struct/base-classes":32,"../util/bind":33,"../util/resource-util":38}],29:[function(a,b,c){"use strict";var d=a("./flash"),e=a("./websockets"),f=a("../environment/index"),g={FLASH:0,WEBSOCKETS:1};b.exports={RuntimeTypes:g,getRuntimeType:function(){return f.supportsWebSockets()?g.WEBSOCKETS:g.FLASH},getRuntime:function(a){return this.getRuntimeType()===g.WEBSOCKETS?new e.Runtime(a):new d.Runtime(a)}}},{"../environment/index":25,"./flash":28,"./websockets":30}],30:[function(a,b,c){"use strict";var d=a("../struct/base-classes"),e=a("../event/bridge"),f=a("../util/bind"),g=a("../connection/registry"),h=a("../device/device-factory"),i=a("../util/resource-util"),j=a("../log/logger"),k=a("../enum/encoding-type"),l=a("../enum/device-type"),m=a("../enum/error-type"),n=e.EventTypes,o=e.ConnectionEventTypes,p=0,q=d.Class.extend({init:function(){this.id=++p,this.hostDevice={id:void 0,name:void 0,type:l.FLASH,encodeType:k.DEVICE_FLASH},this.hostAddress={hostname:"unknown",udpPort:0,tcpPort:0,encodeType:k.ADDRESS},this.registry=void 0,this.config=void 0,this.connections=[],this.pendingConnections=[],this.pending=!1,this.logger=j.getLogger("WebSockets Runtime")},start:function(a){this.config=a,this.hostDevice.name=this.config.options.name,this.hostDevice.id=this.config.options.deviceId,this.handleConnectionMessage=f(this.handleConnectionMessage,this),this.handleDeviceConnectRequest=f(this.handleDeviceConnectRequest,this),i.preloadDesignImages(this.config.options.design),e.on(n.CONNECTION_MESSAGE,this.handleConnectionMessage),e.on(n.DEVICE_CONN_REQUEST,this.handleDeviceConnectRequest),this.logger.info("Starting Websockets Runtime with host id "+this.hostDevice.id);try{this.registry=g.createWebSocketRegistry(this.config),this.registry.start()}catch(b){throw new Error({type:m.RUNTIME_FAILURE,message:b.message})}return this},stop:function(){for(this.logger.info("Stopping WebSockets Runtime with host id "+this.hostDevice.id);this.connections.length>0;)this.removeConnection(this.connections.shift());return this.connections.length=0,this.registry.stop(),this.config=void 0,e.off(n.CONNECTION_MESSAGE,this.handleConnectionMessage),e.off(n.DEVICE_CONN_REQUEST,this.handleDeviceConnectRequest),this},setVisibility:function(a){this.registry.setVisibility(a)},hasReachMaxConnections:function(){return this.connections.length>=this.config.options.maxPlayers},connectionAlreadyRegistered:function(a){for(var b=this.connections.length;--b>-1;)if(this.connections[b].id===a)return!0;return!1},getPendingConnectionIndex:function(a){for(var b=this.pendingConnections.length;--b>-1;)if(this.pendingConnections[b].id===a.id)return b;return-1},addPendingConnection:function(a){var b=this.getPendingConnectionIndex(a);-1===b&&this.pendingConnections.push(a)},removePendingConnection:function(a){var b=this.getPendingConnectionIndex(a);b>-1&&this.pendingConnections.splice(b,1)},addConnection:function(a){this.connections.push(a),this.removePendingConnection(a),this.registry.setPlayerCount(this.connections.length),this.logger.info("Adding connection to Host Runtime...")},removeConnection:function(a){var b=this.connections.indexOf(a);b>-1&&(this.logger.info("Removing connection from Host Runtime..."),this.connections.splice(b,1),this.registry.setPlayerCount(this.connections.length))},handleConnectionMessage:function(a){this.logger.info("Message received form connection device. Event: "+a.type+", device id: "+a.data.device.id),a.type===o.ADD_DEVICE?this.addConnection(a.data.device):a.type===o.REMOVE_DEVICE&&this.removeConnection(a.data.device)},handleDeviceConnectRequest:function(a){var b,c,d=a.device.deviceId,e=a.device.deviceName,f=a.address;this.logger.info("Attempting to connection to device "+d),this.hasReachMaxConnections()?this.logger.warn("Maximium connections already reached. Not connecting to "+d+"."):this.connectionAlreadyRegistered(d)?this.logger.warn("Already connected to "+d+"."):(b="ws://"+f.host+":"+f.reliablePort,this.logger.info("Request to connect to device at "+b+"."),c=h.createDeviceConnection(e,d,this.config),c.connect(b,this.hostDevice,this.hostAddress),this.addPendingConnection(c))}});b.exports={Runtime:q}},{"../connection/registry":6,"../device/device-factory":9,"../enum/device-type":19,"../enum/encoding-type":21,"../enum/error-type":22,"../event/bridge":26,"../log/logger":27,"../struct/base-classes":32,"../util/bind":33,"../util/resource-util":38}],31:[function(a,b,c){"use strict";var d=a("./struct/base-classes"),e=a("./log/logger"),f=a("./event/bridge"),g=a("./device/device-factory"),h=a("./runtime/runtime-factory"),i=a("./util/bind"),j=a("./util/proxy"),k=a("./environment/index"),l=a("./enum/error-type"),m=a("./enum/control-mode-type"),n=f.EventTypes,o=f.ConnectionEventTypes,p=f.DeviceEventTypes,q=a("./enum/dpad-controls"),r="0.5.2",s="none",t=!0,u={name:"Red5 Pro SecondScreen Host",maxPlayers:1,appId:"secondscreen",swfUrl:"swf/secondscreenHost.swf",swfobjectUrl:"swf/swfobject.js",minimumVersion:{major:0,minor:0},design:{orientation:"portrait",touchEnabled:!1,accelerometerEnabled:!1,preload:[],layout:[],images:[]},error:function(){},success:function(){},_error:function(){this.error&&this.error.apply(null,Array.prototype.slice.call(arguments))},_success:function(){this.success&&this.success.apply(null,Array.prototype.slice.call(arguments))}},v=function(a,b){var c;for(c in a)b[c]=a[c];return b},w=function(a){var b,c={},d=/[?&]?([^=]+)=([^&]*)/g;for(a=a.split("+").join(" ");b=d.exec(a);)c[decodeURIComponent(b[1])]=decodeURIComponent(b[2]);return c},x=function(){return Math.floor(16777215*Math.random()*16777215).toString(16)},y=function(a,b,c){a.hasOwnProperty(b)&&!c.hasOwnProperty(b)?c[b]=a[b]:a[b]=c[b]},z=function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},A=function(){return z({SHOW_SLOT_COLOR:n.SHOW_SLOT_COLOR,REGISTRY_DISCONNECT:n.REGISTRY_DISCONNECT},z(p,o))},B=["#ff6600","#ffcc00","#ff3399","#ff0066","#cc00ff","#999900","#9999cc","#00cc99","#287200","#00ccff","#003366","#99ff00","#cc0000","#80cd68","#6600ff"],C=0,D=d.EventEmitter.extend({init:function(){var a;this._super(),this.uid=++C,a=w(k.getLocationSearch()),this.appId=a.appId,this.portalId=a.portalId,this.deviceId=a.appId||x(),this.version=r,this.devices={},this.runtime=void 0,this.config={options:u},this.log=e.getLogger("Red5 Pro SecondScreen Host"),this.handleShowSlotColor=i(this.handleShowSlotColor,this),this.handleDeviceMessage=i(this.handleDeviceMessage,this),this.handleConnectionMessage=i(this.handleConnectionMessage,this),this.handleRegistryDisconnect=i(this.handleRegistryDisconnect,this)},addEventHandlers:function(){this.removeEventHandlers(),f.on(n.DEVICE_MESSAGE,this.handleDeviceMessage),f.on(n.SHOW_SLOT_COLOR,this.handleShowSlotColor),f.on(n.CONNECTION_MESSAGE,this.handleConnectionMessage),f.on(n.REGISTRY_DISCONNECT,this.handleRegistryDisconnect)},removeEventHandlers:function(){f.off(n.DEVICE_MESSAGE,this.handleDeviceMessage),f.off(n.SHOW_SLOT_COLOR,this.handleShowSlotColor),f.off(n.CONNECTION_MESSAGE,this.handleConnectionMessage),f.off(n.REGISTRY_DISCONNECT,this.handleRegistryDisconnect)},start:function(a,b){if("undefined"!=typeof a&&(this.config.options=v(a,this.config.options)),y(this,"appId",this.config.options),y(this,"portalId",this.config.options),y(this,"deviceId",this.config.options),!this.config.options.appId){var c="A proper application id is required for Red5 Pro SecondScreenHost. Provided application id: "+this.config.options.appId;throw this.log.error(c),this.config.options._error(l.APPLICATION_ID_REQUIRED,c),new Error({type:l.APPLICATION_ID_REQUIRED,message:c})}this.appId=this.config.options.appId,"undefined"!=typeof b&&b&&k.forceFlash();try{this.log.info(this.versionStr()),k.addUnloadListener(i(this.stop,this)),this.runtime=h.getRuntime().start(this.config),this.runtime.pending||this.config.options._success(),this.addEventHandlers(),this.log.info("Started with appId "+this.config.options.appId)}catch(d){throw this.removeEventHandlers(),this.config.options._error(d.type,"Could not start SecondScreenHost Runtime: "+d.message+"."),new Error(d)}},stop:function(){var a;this.log.info("Stopping SecondScreenHost instance with appId "+this.config.options.appId),"undefined"!=typeof this.runtime&&this.runtime.stop();for(a in this.devices)this.removeDeviceById(a);this.runtime=void 0,this.removeEventHandlers()},getDeviceById:function(a){return this.devices.hasOwnProperty(a)?this.devices[a]:void 0},allDevices:function(){return function(){return j.initializeWithMap(this.devices,g.getProxyMethods())}}(),setVisibility:function(a){t!==a&&(t=a,"undefined"!=typeof this.runtime&&(this.log.info("Setting visibility on runtime to "+a+"."),this.runtime.setVisibility(t)))},getVisibility:function(){return t},addDevice:function(a){this.log.info("Request to add device "+a.id+"."),this.devices[a.id]=a,this.trigger(o.DEVICE_CONNECTED,{device:a})},removeDeviceById:function(a){var b;this.log.info("Request to remove device "+a+"."),this.getDeviceById(a)?(b=this.devices[a],b.close(),this.log.info("Removing device "+a+"."),delete this.devices[a],this.trigger(o.DEVICE_DISCONNECTED,{device:b})):this.log.warn("Could not find device in list: "+a+".")},versionStr:function(){return"Red5 Pro Second Screen HTML Host :) Version "+this.version},setLogLevel:function(a){e.setLogLevel(a)},handleShowSlotColor:function(a){var b=a.data.slot,c=Math.max(0,b-1)%B.length,d=B[c];this.log.info("Show Slot Color for id "+b+", color: "+d),this.trigger(a.type,{slot:b,color:d})},handleRegistryDisconnect:function(a){this.log.info("Registry disconnection recieved."),this.trigger(a.type)},handleConnectionMessage:function(a){this.log.info("Event receieved on Connection for device "+a.data.device.id+": "+a.type),a.type===o.ADD_DEVICE?this.addDevice(a.data.device):a.type===o.REMOVE_DEVICE&&this.removeDeviceById(a.data.device.id),this.trigger(a.type,a.data)},handleDeviceMessage:function(a){this.log.info("Event receieved on Device for device "+a.data.device.id+": "+a.type),this.trigger(a.type,a.data)}}),E=new D;E.ErrorTypes=l,E.EventTypes=A(),E.ControlModes=m,E.LogLevels=e.LogLevels,E.SlotColors=B,E.DPadControls=q,e.setLogLevel(s),k.exposeNoConflict(E),b.exports=E},{"./device/device-factory":9,"./enum/control-mode-type":18,"./enum/dpad-controls":20,"./enum/error-type":22,"./environment/index":25,"./event/bridge":26,"./log/logger":27,"./runtime/runtime-factory":29,"./struct/base-classes":32,"./util/bind":33,"./util/proxy":37}],32:[function(a,b,c){function d(){}var e=!1,f=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;d.extend=function(a){function b(){!e&&this.init&&this.init.apply(this,arguments)}var c=this.prototype;e=!0;var d=new this;e=!1;for(var g in a)d[g]="function"==typeof a[g]&&"function"==typeof c[g]&&f.test(a[g])?function(a,b){return function(){var d=this._super;this._super=c[a];var e=b.apply(this,arguments);return this._super=d,e}}(g,a[g]):a[g];return b.prototype=d,b.prototype.constructor=b,b.extend=arguments.callee,b},EventEmitter=d.extend({init:function(){this.callbacks={}},addEventListener:function(a,b){if("function"!=typeof b)throw new Error(".on() callback provided was not a function");void 0===this.callbacks[a]&&(this.callbacks[a]=[]),-1===this.getIndexOfFunctionByType(a,b)&&this.callbacks[a].push(b)},on:function(a,b){this.addEventListener(a,b)},removeEventListener:function(a,b){if(void 0!==this.callbacks[a]){var c=this.callbacks[a],d=this.getIndexOfFunctionByType(a,b);d>-1&&c.splice(d,1)}},getIndexOfFunctionByType:function(a,b){if(void 0!==this.callbacks[a]){var c,d=this.callbacks[a];for(c=0;c<d.length;c++)if(d[c]==b)return c;return-1}return-1},off:function(a,b){this.removeEventListener(a,b)},trigger:function(a,b){if(void 0!==this.callbacks[a])for(var c,d=this.callbacks[a],c=0;c<d.length;c++)d[c](b)},triggerWithType:function(a,b){b.type=a,this.trigger(a,b)}}),b.exports={Class:d,EventEmitter:EventEmitter}},{}],33:[function(a,b,c){"use strict";b.exports=function(a,b){return function(){return a.apply(b,arguments)}}},{}],34:[function(a,b,c){"use strict";b.exports=function(a,b,c){var d,e=function(){clearTimeout(d),a.apply(c,arguments)};return function(){clearTimeout(d),d=setTimeout(e,b,arguments)}}},{}],35:[function(a,b,c){"use strict";var d=a("../struct/base-classes"),e=a("../environment/index"),f=d.Class.extend({init:function(){this.store={},this.indexStore=[]},setCache:function(a,b){this.store[a]=b,this.indexStore.push(a)},getCache:function(a){return this.store.hasOwnProperty(a)?this.store[a]:void 0},getResourceId:function(a){return"undefined"==typeof a?-1:this.indexStore.indexOf(a)+1}}),g=d.Class.extend({init:function(a,b,c){this.store=a,this.imageUrls=b||[],this.imageData=[],this.queue=[],this.callback=c},_load:function(a){!function(b){e.loadImage(a,function(){b.next()},function(c){b.imageData.push(c),b.store.setCache(a,c),b.next()})}(this)},start:function(){var a,b,c,d=this.imageUrls.length;for(a=0;d>a;a++)b=this.imageUrls[a],c=this.store.getCache(b),c?this.imageData.push(c):this.queue.push(b);this.next()},next:function(){this.queue.length>0?this._load(this.queue.shift()):this.callback&&this.callback.call(null,this.imageData)}}),h=new f;b.exports={loadImages:function(a,b){new g(h,a,b).start()},getCacheFromUrl:function(a){return h.getCache(a)},getResourceIdFromUrl:function(a){return h.getResourceId(a)}}},{"../environment/index":25,"../struct/base-classes":32}],36:[function(a,b,c){"use strict";b.exports={toJSON:function(a){try{return JSON.parse(decodeURIComponent(a))}catch(b){}return void 0}}},{}],37:[function(a,b,c){"use strict";var d=function(a){this.objectMap=a},e=function(a,b){return function(){var c=Array.prototype.slice.call(arguments);a.execute.apply(a,[b].concat(c))}};d.prototype={execute:function(){var a,b,c=arguments[0],d=Array.prototype.slice.call(arguments).slice(1);for(a in this.objectMap)b=this.objectMap[a],b[c].apply(b,d);return this}},b.exports={initializeWithMap:function(a,b){var c,f,g=new d(a),h=b.length;for(c=0;h>c;c++)f=b[c],g[f]=e(g,f);return g}}},{}],38:[function(a,b,c){"use strict";var d=a("./image-cache-resource"),e=function(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c},f=function(a,b){"undefined"!=typeof a&&-1===b.indexOf(a)&&(b[b.length]=a)},g=function(a){var b,c,d,e,g=a.layout;if(void 0!==g){for(c=g.length,e=a.__resources__||(a.preload?a.preload.slice():[]),b=0;c>b;b++)d=g[b],"image"===d.type?f(d.src,e):"button"===d.type?(f(d.srcUp,e),f(d.srcDown,e)):"slider"===d.type&&(f(d.srcUp,e),f(d.srcDown,e),f(d.srcBackground,e));return a.__resources__=e,e}},h=function(a){var b="",c=a.src||a.srcUp,e=a.srcDown,f=a.srcBackground,g=d.getResourceIdFromUrl(c)||-1,h=d.getResourceIdFromUrl(e)||-1,i=d.getResourceIdFromUrl(f)||-1;return"image"===a.type?b+='<Asset name="up" resourceRef="'+g+'" />':"button"===a.type?(b+='<Asset name="up" resourceRef="'+g+'" />',b+='<Asset name="down" resourceRef="'+h+'" />'):"slider"===a.type&&(b+='<Asset name="up" resourceRef="'+g+'" />',b+='<Asset name="down" resourceRef="'+h+'" />',b+='<Asset name="background" resourceRef="'+i+'" />'),b},i=function(a,b,c){var e,f=a.src||a.srcUp,g=d.getCacheFromUrl(f),i=d.getResourceIdFromUrl(f)||-1;return a.x=void 0===a.x?0:a.x,a.y=void 0===a.y?0:a.y,void 0===a.width&&void 0!==g&&(a.width=g.width),void 0===a.height&&void 0!==g&&(a.height=g.height),e='<DisplayObject type="'+a.type+'" top="'+a.y/c+'" left="'+a.x/b+'" width="'+a.width/b+'" height="'+a.height/c+'" id="'+i+'" ',"button"===a.type&&a.id?e+='functionHandler="'+a.id+'" ':"slider"===a.type&&(e+='sliderId="'+a.sliderId+'" ',e+='orientation="'+(a.orientation?a.orientation.toLowerCase():"horizontal")+'" ',e+='handleWidth="'+a.handleWidth/b+'" ',e+='handleHeight="'+a.handleHeight/c+'" '),a.text&&(e+='text="'+a.text+'" textSize="'+Number(a.textSize)/c+'" '),void 0!==a.color&&(e+='color="'+a.color+'" '),a.hidden&&(e+='hidden="yes" '),e+=">",e+=h(a),e+="</DisplayObject>"},j=function(a){var b,c=a.layout,d=a.width,e=a.height,f=c?c.length:0,g="<Layout/>",h=[];if(f>0){for(h.push("<Layout>"),b=0;f>b;b++)h.push(i(c[b],d,e));h.push("</Layout>"),g=h.join("\n")}return g},k=function(a,b){var c,e,f=b.length,g=["<Resources>"];for(c=0;f>c;c++)e=b[c],g.push('<Resource id="'+d.getResourceIdFromUrl(e.url)+'" type="image"><data><![CDATA['+e.data+"]]></data></Resource>");return g.push("</Resources>"),g.join("\n")},l=function(a,b){var c;return"portrait"===a.orientation?(a.width=320,a.height=480):(a.width=480,a.height=320),c='<?xml version="1.0" encoding="utf-8"?>\n<BMApplicationScheme version="0.1" orientation="'+a.orientation+'" touchEnabled="'+(a.touchEnabled?"yes":"no")+'" accelerometerEnabled="'+(a.accelerometerEnabled?"yes":"no")+'">\n',c+=k(a,b),c+=j(a),c+="</BMApplicationScheme>"};b.exports={cloneDesign:function(a){for(var b=e(a),c=a.layout,d=c?c.length:0,f=new Array(d);--d>-1;)f[d]=e(c[d]);return b.__resources__&&(b.__resources__=b.__resources__.slice()),b.layout=f,b},preloadDesignImages:function(a){d.loadImages(g(a))},generateControllerXML:function(a,b){d.loadImages(g(a),function(c){b&&b.call(null,l(a,c))})},generateUpdateXML:function(a){return"<BMApplicationScheme>"+j(a)+"</BMApplicationScheme>"}}},{"./image-cache-resource":35}]},{},[31]);